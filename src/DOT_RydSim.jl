########################################################################
#                                                                      #
# DOT_RydSim.jl                                                        #
#                                                                      #
# (c) Dirk Oliver Theis 2023                                           #
#                                                                      #
# License:                                                             #
#                                                                      #
#             Apache 2.0                                               #
#                                                                      #
########################################################################

"""
Module `DOT_RydSim`

Quantum simulation of (small!!) arrays of Rydberg atoms.

# Exports

## General
* (nothing yet)

## Number definitions (in sub-modules `Numbers`ğ‘¥ğ‘¦ğ‘§)
* (also nothing)

# Sub-modules

Sub-module names are not exported.

* `SchrÃ¶dinger` â€” Simulation of quantum evolution
"""
module DOT_RydSim
export Fn_Select, schrÃ¶d!


# ***************************************************************************************************************************
# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 0. Packages

using DOT_NiceMath
using DOT_NiceMath.NumbersF64

using  Unitful: Quantity, Î¼s, ğ“, Unit, FreeUnits
import Unitful

# ***************************************************************************************************************************
# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 1. Types, Units, Helpers

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 1.1. Unit types

const Î¼s_t{              ğ•‚<:Real } =                                                                # 1â†’ `Î¼s_t`
    Quantity{ğ•‚, ğ“,
             FreeUnits{ (Unit{:Second,ğ“}(-6, 1//1),),
                        ğ“,
                        nothing }
             }

const Rad_per_Î¼s_t{      ğ•‚<:Real } =                                                                # 1â†’ `Rad_per_Î¼s_t`
    Quantity{ğ•‚, ğ“^(-1//1),
             FreeUnits{ (Unit{:Second,ğ“}(-6,-1//1),),
                        ğ“^(-1//1),
                        nothing }
             }

const RadperÎ¼s_per_Î¼s_t{ ğ•‚<:Real } =                                                                # 1â†’ `Rad_per_Î¼s_t`
    Quantity{ğ•‚, ğ“^(-2//1),
             FreeUnits{ (Unit{:Second,ğ“}(-6,-2//1),),
                        ğ“^(-2//1),
                        nothing }
             }


const GHz_t{             ğ•‚<:Real } =                                                                # 1â†’ `Hz_t`
    Quantity{ğ•‚, ğ“^(-1//1),
             FreeUnits{ (Unit{:Hertz,ğ“^(-1//1)}(9,1//1),),
                        ğ“^(-1//1),
                        nothing }
             }


# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 1.2. Types: Fn_Select

"""
Module `Fn_Select`

This sub-module of `DOT_RydSim` provides the dummy types
* `STEP` and
* `AVG`
to select the method for the pulse-shape functions.  Used in the Function Maker functions below.

"""
module Fn_Select
    export STEP, AVG

    abstract type Function_Selection end

    struct STEP <: Function_Selection end
    struct AVG  <: Function_Selection end

end

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 1.3. Sub-module SchrÃ¶dinger

include("SchrÃ¶dinger.mod.jl")

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 1.4. Helper: Rounding

using DOT_NiceMath.NumbersF64: â„¤, â„š

function Î´round(x ::Quantity{ğ•‚â‚,Tâ‚,Fâ‚} ; Î´ ::Quantity{â„š,Tâ‚‚,Fâ‚‚}) ::Quantity{â„š,Tâ‚‚,Fâ‚‚}    where{ğ•‚â‚, Tâ‚,Fâ‚, Tâ‚‚,Fâ‚‚}
    Î´â‹…rationalize(â„¤,floor(x/Î´ +1//2))
end

# continue here: Copy round fn from Pluto notebook

# _ratdiv(num,den) = rat( NoUnits( div( num, den , RoundNearest) ) )
# _round(x::Frequency ; Î´::Frequency) = MHz(Î´)â‹…_ratdiv( MHz(x),MHz(Î´) )
# _round(x::Time      ; Î´::Time     ) =  Î¼s(Î´)â‹…_ratdiv(  Î¼s(x), Î¼s(Î´) )
# _round(x::Length    ; Î´::Length   ) =  Î¼m(Î´)â‹…_ratdiv(  Î¼m(x), Î¼m(Î´) )

# round_Î©(dev::HW_Descr,  ğ›º::Frequency) = _round(ğ›º;Î´=dev.ğ›ºáµ£â‚‘â‚›)
# round_Î”(dev::HW_Descr,  ğ›¥::Frequency) = _round(ğ›¥;Î´=dev.ğ›¥áµ£â‚‘â‚›)
# round_t(dev::HW_Descr,  ğ‘¡::Time     ) = _round(ğ‘¡;Î´=dev.ğ‘¡áµ£â‚‘â‚›)

# round_xy(dev::HW_Descr, ğ‘§::Length   ) = _round(ğ‘§;Î´=dev.lattice.posáµ£â‚‘â‚›)

# Ï†Ï€(dev::HW_Descr) = dev.ğœ‘áµ£â‚‘â‚›â‹…_ratdiv(Ï€,dev.ğœ‘áµ£â‚‘â‚›)





# ***************************************************************************************************************************
# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 2. Function maker


# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 2.2. Î©_BangBang

function make_ctrl_fn__Î©_bangbang( ğ‘¡â‚€       ::Î¼s_t{â„š},
                                   ğ‘¡â‚       ::Î¼s_t{â„š},
                                   ğ‘‡        ::Î¼s_t{â„š},
                                   ğ›º_ğ‘¡ğ‘ğ‘Ÿğ‘”ğ‘’ğ‘¡ ::Rad_per_Î¼s_t{â„š}
                                   ;
                                   ğ›ºâ‚˜â‚â‚“       ::Rad_per_Î¼s_t{â„š},
                                   ğ›ºáµ£â‚‘â‚›       ::Rad_per_Î¼s_t{â„š},
                                   ğ›º_ğ‘šğ‘ğ‘¥_ğ‘ ğ‘™ğ‘’ğ‘¤ ::RadperÎ¼s_per_Î¼s_t{â„š},

                                   Ï†áµ£â‚‘â‚›       ::â„š,

                                   ğ‘¡â‚˜â‚â‚“       ::Î¼s_t{â„š},
                                   ğ‘¡áµ£â‚‘â‚›       ::Î¼s_t{â„š},
                                   ğ›¥ğ‘¡â‚˜áµ¢â‚™      ::Î¼s_t{â„š}                  ) ::Function

    @assert -ğ›ºâ‚˜â‚â‚“ < ğ›º_ğ‘¡ğ‘ğ‘Ÿğ‘”ğ‘’ğ‘¡ < +ğ›ºâ‚˜â‚â‚“
    @assert 0Î¼s â‰¤ ğ‘¡â‚€ < ğ‘¡â‚ â‰¤ ğ‘‡

    ğ‘’ğ‘£ğ‘’ğ‘›ğ‘¡ğ‘  ::NTuple{5,â„š} =
        (
                #   wait before pulse
            ğ‘¡â‚€, #1              âŒ
                #   ramp up     |
            1//1,   #2              |
                #   plateau     |  pulse, incl. ramp-down
            1//1,   #3              |
                #   ramp down   |
            ğ‘¡â‚,  #4              âŒŸ
                #   wait after pulse
            ğ‘‡   #5
        )


    function
    ğœ”(::Type{Fn_Select.AVG},  ğ‘¡ ::Î¼s_t{ğ•‚} ;  ğ›¥ğ‘¡ ::Î¼s_t{ğ•‚}) ::ğ•‚   where{ğ•‚<:Real}
        blah
    end
    function
    ğœ”(::Type{Fn_Select.STEP}, ğ‘¡ ::Î¼s_t{ğ•‚} ;  Îµ  ::Î¼s_t{ğ•‚}) ::ğ•‚   where{ğ•‚<:Real}
        blubb
    end


#     for near-square:
#
#     phases/events
# t[0]=0
#         wait_before
# ğ‘¡[1]
#         ramp_up
# ğ‘¡[2]
#         hold
# ğ‘¡[3]
#         ramp_down
# ğ‘¡[4]
#         wait_after
# ğ‘¡[5]=ğ‘‡
#
#
#     return: ğœ” ::Function, Î³::â„‚


   end


end # module DOT_RydSim
# EOF
